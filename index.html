<script>
const apiURL = "https://script.google.com/macros/s/AKfycbwzRoFDEI8L9nznDjX0xRuLcmGvF4lVks3rM6uJVfQZ0y-6RNe5b8TCKSdMw0YTIvx9BQ/exec";

const icons = {
  "Ø§Ù„Ø§Ø³Ù…": "ğŸ‘¤",
  "ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†": "ğŸ—“",
  "Ø³Ø§Ø¹Ø§Øª": "ğŸ•",
  "Ø§Ù„Ù‚Ø³Ù…": "ğŸ¢",
  "Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ": "ğŸ’¼",
  "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†": "ğŸ“",
  "Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±": "ğŸ§‘â€ğŸ’¼"
};

async function searchData() {
  const codeInput = document.getElementById("codeInput");
  const code = codeInput.value.trim();
  const resultDiv = document.getElementById("result");

  resultDiv.innerHTML = "";

  // Ù„Ùˆ Ø§Ù„Ø­Ù‚Ù„ ÙØ§Ø¶ÙŠ
  if (!code) {
    codeInput.classList.add("shake");
    setTimeout(() => codeInput.classList.remove("shake"), 400);
    resultDiv.innerHTML = "<p style='color:orange;'>Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆØ¸Ù</p>";
    return;
  }

  // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¥Ù† ÙˆØ¬Ø¯Øª
  const oldCard = resultDiv.querySelector(".card.show");
  if (oldCard) {
    oldCard.classList.remove("show");
    oldCard.classList.add("hide");
    await new Promise(res => setTimeout(res, 400));
    resultDiv.innerHTML = "";
  }

  // Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø«
  resultDiv.innerHTML = `<div class="loading"><span></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</div>`;

  try {
    const response = await fetch(`${apiURL}?code=${encodeURIComponent(code)}`);
    const result = await response.json();

    resultDiv.innerHTML = "";

    if (result.ok && result.data) {
      const card = document.createElement("div");
      card.classList.add("card");

      for (const header in result.data) {
        if (!result.data[header]) continue; // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙØ§Ø±ØºØ©
        const rowDiv = document.createElement("div");
        rowDiv.classList.add("data-row");
        rowDiv.innerHTML = `<span class="icon">${icons[header] || "ğŸ“Œ"}</span> <strong>${header}:</strong> ${result.data[header]}`;
        card.appendChild(rowDiv);
      }

      resultDiv.appendChild(card);
      setTimeout(() => card.classList.add("show"), 50);
    } else {
      resultDiv.innerHTML = "<p style='color:red;'>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¸Ù</p>";
    }
  } catch (error) {
    resultDiv.innerHTML = "<p style='color:red;'>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ù‹Ø§</p>";
    console.error(error);
  }

  // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚Ù„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¨Ø­Ø«
  codeInput.value = "";
}

document.getElementById("codeInput").addEventListener("keypress", function(e) {
  if (e.key === "Enter") searchData();
});
</script>
