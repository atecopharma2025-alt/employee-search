<script>
const apiURL = "https://script.google.com/macros/s/AKfycbwzRoFDEI8L9nznDjX0xRuLcmGvF4lVks3rM6uJVfQZ0y-6RNe5b8TCKSdMw0YTIvx9BQ/exec";

const icons = {
  "الاسم": "👤",
  "تاريخ التعيين": "🗓",
  "ساعات": "🕐",
  "القسم": "🏢",
  "المسمى الوظيفي": "💼",
  "العنوان": "📍",
  "المدير المباشر": "🧑‍💼"
};

async function searchData() {
  const codeInput = document.getElementById("codeInput");
  const code = codeInput.value.trim();
  const resultDiv = document.getElementById("result");

  resultDiv.innerHTML = "";

  // لو الحقل فاضي
  if (!code) {
    codeInput.classList.add("shake");
    setTimeout(() => codeInput.classList.remove("shake"), 400);
    resultDiv.innerHTML = "<p style='color:orange;'>من فضلك أدخل كود الموظف</p>";
    return;
  }

  // إخفاء البطاقة القديمة إن وجدت
  const oldCard = resultDiv.querySelector(".card.show");
  if (oldCard) {
    oldCard.classList.remove("show");
    oldCard.classList.add("hide");
    await new Promise(res => setTimeout(res, 400));
    resultDiv.innerHTML = "";
  }

  // عرض حالة البحث
  resultDiv.innerHTML = `<div class="loading"><span></span> جاري البحث...</div>`;

  try {
    const response = await fetch(`${apiURL}?code=${encodeURIComponent(code)}`);
    const result = await response.json();

    resultDiv.innerHTML = "";

    if (result.ok && result.data) {
      const card = document.createElement("div");
      card.classList.add("card");

      for (const header in result.data) {
        if (!result.data[header]) continue; // تجاهل الحقول الفارغة
        const rowDiv = document.createElement("div");
        rowDiv.classList.add("data-row");
        rowDiv.innerHTML = `<span class="icon">${icons[header] || "📌"}</span> <strong>${header}:</strong> ${result.data[header]}`;
        card.appendChild(rowDiv);
      }

      resultDiv.appendChild(card);
      setTimeout(() => card.classList.add("show"), 50);
    } else {
      resultDiv.innerHTML = "<p style='color:red;'>لم يتم العثور على الموظف</p>";
    }
  } catch (error) {
    resultDiv.innerHTML = "<p style='color:red;'>حدث خطأ أثناء جلب البيانات، حاول لاحقًا</p>";
    console.error(error);
  }

  // تفريغ الحقل بعد البحث
  codeInput.value = "";
}

document.getElementById("codeInput").addEventListener("keypress", function(e) {
  if (e.key === "Enter") searchData();
});
</script>
