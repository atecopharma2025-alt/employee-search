<script>
const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ-kXTdaWwYZdVpvPE7t81BR0ML8CFX8BjZPbYKUxE6sd-SWB2zg4I7sVLxQBDg4yIgKzJ8nB2LOwzM/pub?gid=0&single=true&output=csv";

async function searchData() {
  const code = document.getElementById("codeInput").value.trim().toLowerCase(); // تجاهل حالة الأحرف
  const resultDiv = document.getElementById("result");
  resultDiv.innerHTML = "";

  if (!code) {
    resultDiv.innerHTML = "<p>من فضلك أدخل كود الموظف</p>";
    return;
  }

  // عرض تحميل مؤقت
  resultDiv.innerHTML = `<div class="loading"><span></span> جاري البحث...</div>`;

  try {
    const response = await fetch(sheetURL);
    const csvText = await response.text();

    Papa.parse(csvText, {
      header: true,
      skipEmptyLines: true,
      complete: function(results) {
        const match = results.data.find(row => {
          const firstCell = String(row[Object.keys(row)[0]] || "").trim().toLowerCase();
          return firstCell === code;
        });

        resultDiv.innerHTML = ""; // مسح التحميل المؤقت

        if (match) {
          const card = document.createElement("div");
          card.classList.add("card");

          for (let header in match) {
            const rowDiv = document.createElement("div");
            rowDiv.classList.add("data-row");
            rowDiv.innerHTML = `<span class="icon">📌</span> <strong>${header}:</strong> ${match[header]}`;
            card.appendChild(rowDiv);
          }

          resultDiv.appendChild(card);
          setTimeout(() => card.classList.add("show"), 50);
        } else {
          resultDiv.innerHTML = "<p>لم يتم العثور على الموظف</p>";
        }
      }
    });
  } catch (error) {
    resultDiv.innerHTML = "<p>خطأ في جلب البيانات</p>";
  }
}
</script>
