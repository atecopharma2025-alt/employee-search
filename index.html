<script>
const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ-kXTdaWwYZdVpvPE7t81BR0ML8CFX8BjZPbYKUxE6sd-SWB2zg4I7sVLxQBDg4yIgKzJ8nB2LOwzM/pub?gid=0&single=true&output=csv";

async function searchData() {
  const code = document.getElementById("codeInput").value.trim().toLowerCase(); // ØªØ¬Ø§Ù‡Ù„ Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø­Ø±Ù
  const resultDiv = document.getElementById("result");
  resultDiv.innerHTML = "";

  if (!code) {
    resultDiv.innerHTML = "<p>Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆØ¸Ù</p>";
    return;
  }

  // Ø¹Ø±Ø¶ ØªØ­Ù…ÙŠÙ„ Ù…Ø¤Ù‚Øª
  resultDiv.innerHTML = `<div class="loading"><span></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</div>`;

  try {
    const response = await fetch(sheetURL);
    const csvText = await response.text();

    Papa.parse(csvText, {
      header: true,
      skipEmptyLines: true,
      complete: function(results) {
        const match = results.data.find(row => {
          const firstCell = String(row[Object.keys(row)[0]] || "").trim().toLowerCase();
          return firstCell === code;
        });

        resultDiv.innerHTML = ""; // Ù…Ø³Ø­ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¤Ù‚Øª

        if (match) {
          const card = document.createElement("div");
          card.classList.add("card");

          for (let header in match) {
            const rowDiv = document.createElement("div");
            rowDiv.classList.add("data-row");
            rowDiv.innerHTML = `<span class="icon">ğŸ“Œ</span> <strong>${header}:</strong> ${match[header]}`;
            card.appendChild(rowDiv);
          }

          resultDiv.appendChild(card);
          setTimeout(() => card.classList.add("show"), 50);
        } else {
          resultDiv.innerHTML = "<p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¸Ù</p>";
        }
      }
    });
  } catch (error) {
    resultDiv.innerHTML = "<p>Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>";
  }
}
</script>
